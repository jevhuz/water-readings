<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ūdens skaitītāju rādījumu iesniegšana</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f6f7fb; margin: 0; }
    header { padding: 20px; background: #fff; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; }
    h1 { margin: 0; font-size: 20px; }
    select { padding: 4px; }
    main { max-width: 600px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 15px; padding: 10px 15px; cursor: pointer; }
    #msg { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1 id="title">Ūdens skaitītāju rādījumu iesniegšana</h1>
    <select id="lang">
      <option value="lv">Lat</option>
      <option value="ru">Рус</option>
      <option value="en">Eng</option>
    </select>
  </header>

  <main>
    <div id="subtitle">Daudzdzīvokļu mājas iedzīvotājiem. Aizpildiet formu un nospiediet “Nosūtīt”.</div>

    <form id="form">
      <label id="labelFlat" for="flat">Dzīvoklis</label>
      <input id="flat" name="flat" type="number" required />

      <input id="clientCode" name="clientCode" type="hidden" />

      <label id="labelPeriod" for="date">Periods</label>
      <input id="date" name="date" type="month" required />

      <label id="labelCold" for="cold">Aukstā ūdens skaitītāja rādījums (m³)</label>
      <input id="cold" name="cold" type="text" inputmode="decimal" pattern="^[0-9]+([.,][0-9]{1,3})?$" required />

      <label id="labelHot" for="hot">Karstā ūdens skaitītāja rādījums (m³)</label>
      <input id="hot" name="hot" type="text" inputmode="decimal" pattern="^[0-9]+([.,][0-9]{1,3})?$" required />

      <label id="labelContact" for="contact">Kontakts (e-pasts/tālrunis)</label>
      <input id="contact" name="contact" type="text" />

      <label id="labelPin" for="pin">Dzīvokļa kods (PIN)</label>
      <input id="pin" name="pin" type="password" required />
      <div id="pinNote" style="font-size:12px;color:#555;">Vienkārša piekļuve ar kodu: aizsargā no spama un svešiniekiem.</div>

      <button type="submit" id="btnSend">Nosūtīt</button>
      <button type="reset" id="btnClear">Notīrīt</button>
    </form>

    <div id="msg"></div>
    <footer id="footer" style="margin-top:10px;font-size:12px;color:#555;">
      Iesniedzot formu, jūs piekrītat datu apstrādei.
    </footer>
  </main>

<script>
window.onload = function () {
  const translations = {
    ru: { title:"Передача показаний воды", subtitle:"Для жителей дома. Заполните форму и нажмите «Отправить».", flat:"Квартира", period:"Период", cold:"ХВС — показание счётчика (м³)", hot:"ГВС — показание счётчика (м³)", contact:"Контакт (e-mail/тел.)", pin:"Код квартиры (PIN)", pinNote:"Простой доступ по коду: защитит от спама и посторонних.", send:"Отправить", clear:"Очистить", footer:"Отправляя форму, вы соглашаетесь на обработку данных.", success:"Спасибо! Показания отправлены.", error:"Ошибка отправки." },
    lv: { title:"Ūdens skaitītāju rādījumu iesniegšana", subtitle:"Daudzdzīvokļu mājas iedzīvotājiem. Aizpildiet formu un nospiediet “Nosūtīt”.", flat:"Dzīvoklis", period:"Periods", cold:"Aukstā ūdens skaitītāja rādījums (m³)", hot:"Karstā ūdens skaitītāja rādījums (m³)", contact:"Kontakts (e-pasts/tālrunis)", pin:"Dzīvokļa kods (PIN)", pinNote:"Vienkārša piekļuve ar kodu: aizsargā no spama un svešiniekiem.", send:"Nosūtīt", clear:"Notīrīt", footer:"Iesniedzot formu, jūs piekrītat datu apstrādei.", success:"Paldies! Rādījumi nosūtīti.", error:"Sūtīšanas kļūda." },
    en: { title:"Water Meter Reading Submission", subtitle:"For building residents. Fill out the form and click “Submit”.", flat:"Apartment", period:"Period", cold:"Cold water meter reading (m³)", hot:"Hot water meter reading (m³)", contact:"Contact (email/phone)", pin:"Apartment code (PIN)", pinNote:"Simple code access: protects from spam and outsiders.", send:"Submit", clear:"Clear", footer:"By submitting this form, you agree to the processing of data.", success:"Thank you! Your readings have been submitted.", error:"Submission error." }
  };

  function setLang(l) {
    const t = translations[l] || translations.lv; // подстрахуемся
    document.getElementById('title').textContent = t.title;
    document.getElementById('subtitle').textContent = t.subtitle;
    document.getElementById('labelFlat').textContent = t.flat;
    document.getElementById('labelPeriod').textContent = t.period;
    document.getElementById('labelCold').textContent = t.cold;
    document.getElementById('labelHot').textContent = t.hot;
    document.getElementById('labelContact').textContent = t.contact;
    document.getElementById('labelPin').textContent = t.pin;
    document.getElementById('pinNote').textContent = t.pinNote;
    document.getElementById('btnSend').textContent = t.send;
    document.getElementById('btnClear').textContent = t.clear;
    document.getElementById('footer').textContent = t.footer;
  }

  // первичная инициализация языка: lv по умолчанию
  const saved = localStorage.getItem('lang');
  const initial = (saved === 'ru' || saved === 'lv' || saved === 'en') ? saved : 'lv';
  setLang(initial);
  const langSel = document.getElementById('lang');
  langSel.value = initial;
  langSel.addEventListener('change', () => {
    localStorage.setItem('lang', langSel.value);
    setLang(langSel.value);
  });

  // генерация кода клиента M5-[номер]
  const flatInput = document.getElementById('flat');
  const codeInput = document.getElementById('clientCode');
  flatInput.addEventListener('input', () => {
    const num = flatInput.value.trim();
    codeInput.value = num ? `M5-${num}` : '';
  });

  // нормализация десятичного разделителя
  function norm(v){ return String(v).replace(/\s+/g,'').replace(',', '.'); }

  // отправка формы
  const form = document.getElementById('form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const payload = {
      flat: form.flat.value.trim(),
      date: form.date.value,
      cold: norm(form.cold.value),
      hot:  norm(form.hot.value),
      clientCode: form.clientCode.value.trim(),
      contact: form.contact.value.trim(),
      pin: form.pin.value.trim()
    };
    try {
      await fetch("__PASTE_YOUR_GAS_WEBAPP_URL_HERE__", {
        method:'POST', mode:'no-cors',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const t = translations[localStorage.getItem('lang')||'lv'];
      document.getElementById('msg').style.color = 'green';
      document.getElementById('msg').textContent = t.success;
      form.reset();
    } catch {
      const t = translations[localStorage.getItem('lang')||'lv'];
      document.getElementById('msg').style.color = 'red';
      document.getElementById('msg').textContent = t.error;
    }
  });
};
</script>
</body>
</html>
